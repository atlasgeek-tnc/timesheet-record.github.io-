<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Weekly Timesheet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root { --bg:#f7f7fb; --card:#fff; --line:#e7e7ef; --brand:#0f62fe; --text:#111; --muted:#666; }
    * { box-sizing: border-box; }
    body { margin:0; background:var(--bg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--text); }
    .wrap { max-width: 900px; margin: 36px auto; padding: 0 16px; }
    .card { background:var(--card); border-radius:16px; box-shadow: 0 12px 30px rgba(0,0,0,.08); padding:24px; }
    h1 { margin:0 0 8px; font-size:22px; }
    .grid { display:grid; grid-template-columns: repeat(12, 1fr); gap:12px; }
    .c3 { grid-column: span 3; } .c4 { grid-column: span 4; } .c6 { grid-column: span 6; } .c8 { grid-column: span 8; } .c12 { grid-column: span 12; }
    label { display:block; font-size:12px; color:#333; margin-bottom:6px; }
    input, button {
      width:100%; padding:10px; border:1px solid #ddd; border-radius:10px; font-size:14px; background:#fff;
    }
    button { background:var(--brand); color:#fff; font-weight:600; cursor:pointer; border:none; }
    .row { display:flex; gap:12px; align-items:center; }
    .msg { margin-top:10px; font-weight:600; }
    .ok { color:#0a8a00; } .err { color:#b00020; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Weekly Timesheet</h1>
      <div class="grid">
        <div class="c4">
          <label>Employee ID *</label>
          <input id="employeeId" required>
        </div>
        <div class="c8">
          <label>Employee Name *</label>
          <input id="employeeName" required>
        </div>

        <div class="c6">
          <label>Project</label>
          <input id="project">
        </div>
        <div class="c6">
          <label>Task</label>
          <input id="task">
        </div>

        <div class="c6">
          <label>Week Of (any date in week) *</label>
          <input id="weekDate" type="date" required>
        </div>
        <div class="c6">
          <label>Total Hours (auto)</label>
          <input id="total" type="number" step="0.25" readonly>
        </div>

        <div class="c12">
          <div class="grid">
            <div class="c3"><label>Mon</label><input id="mon" type="number" min="0" step="0.25" value="0"></div>
            <div class="c3"><label>Tue</label><input id="tue" type="number" min="0" step="0.25" value="0"></div>
            <div class="c3"><label>Wed</label><input id="wed" type="number" min="0" step="0.25" value="0"></div>
            <div class="c3"><label>Thu</label><input id="thu" type="number" min="0" step="0.25" value="0"></div>
            <div class="c3"><label>Fri</label><input id="fri" type="number" min="0" step="0.25" value="0"></div>
            <div class="c3"><label>Sat</label><input id="sat" type="number" min="0" step="0.25" value="0"></div>
            <div class="c3"><label>Sun</label><input id="sun" type="number" min="0" step="0.25" value="0"></div>
          </div>
        </div>

        <div class="c12">
          <button id="submitBtn" style="margin-top:14px;">Submit</button>
          <div id="msg" class="msg"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 1) Put your Apps Script Web App /exec URL here:
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyY6bqeIRbAKBXQZUxtrZT35TmORz_n6dKatTK0OGmvE5tZIRck7pYvTUC2tOKmlPtL/exec';

    const $ = id => document.getElementById(id);
    const dayIds = ['mon','tue','wed','thu','fri','sat','sun'];

    // Auto-calc total
    function calcTotal() {
      const t = dayIds.reduce((a,id)=> a + (parseFloat($(id).value||'0')||0), 0);
      $('total').value = t.toFixed(2);
    }
    dayIds.forEach(id => $(id).addEventListener('input', calcTotal));
    calcTotal();

    $('submitBtn').addEventListener('click', async () => {
      const fd = new FormData();
      fd.append('employeeId', $('employeeId').value.trim());
      fd.append('employeeName', $('employeeName').value.trim());
      fd.append('project', $('project').value.trim());
      fd.append('task', $('task').value.trim());
      fd.append('weekDate', $('weekDate').value);
      // Append daily hours as mon/tue/... keys
      dayIds.forEach(id => fd.append(id.slice(0,3), $(id).value));

      if (!fd.get('employeeId') || !fd.get('employeeName') || !fd.get('weekDate')) {
        return show('Please fill the required fields.', false);
      }

      try {
        const res = await fetch(WEB_APP_URL, { method: 'POST', body: fd }); // no headers → no CORS preflight
        // Try parsing JSON; if Apps Script ever responds non-JSON, this will fail gracefully
        const data = await res.json().catch(() => ({}));
        if (res.ok && data.ok) {
          show(data.message || 'Submitted ✅', true);
        } else {
          show(data.message || 'Submission failed', false);
        }
      } catch (e) {
        show('Network/CORS error: check Web App access and owner authorization.', false);
      }
    });

    function show(text, ok) {
      const el = $('msg');
      el.textContent = text;
      el.className = 'msg ' + (ok ? 'ok' : 'err');
    }
  </script>
</body>
</html>
